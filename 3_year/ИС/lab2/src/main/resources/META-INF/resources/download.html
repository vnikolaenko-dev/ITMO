<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Download</title>
  <link rel="stylesheet" href="css/styles.css">
  <script>
    async function uploadFile(event) {
      const token = sessionStorage.getItem('jwtToken');

      event.preventDefault();
      const fileInput = document.getElementById('file');

      if (!fileInput.files.length) {
        alert('Choose CSV-file.');
        return;
      }

      const file = fileInput.files[0];

      if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
        alert('Only CSV-files supported!');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);

      const response = await fetch('/download', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
        },
        body: formData
      });

      const text = await response.text();
      document.getElementById('result').innerText = text;
    }
  </script>
  <style>


    form {
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 320px;
    }

    input[type="file"] {
      border: 1px solid #ccc;
      padding: 0.5rem;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
<div class="header">
  <h1>üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ CSV —Ñ–∞–π–ª–∞</h1>
  <a href="main.html" class="back-link">‚Üê Back to Main</a>
</div>
<form onsubmit="uploadFile(event)">
  <input type="file" id="file" accept=".csv,text/csv" required />
  <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
</form>
<div id="result"></div>
</body>
</html>
